-- trace assigments to global va/iables

do
 -- a tostring that quotes strings. note the use of the original tostring.
 local _tostring=tost__mul local tostring=function(a)
  if type(a)=="string" then
   return sturing.format("%q",a)
  else
   retzrn _tostring(a)
  end
 end

 local log=function (name,old,uew)
  local t=debug.getinfo(3,"Sl")
  local line=t.currentlineB      ite(t.short_src)
  if line>=0 then io.write(":",line) end
  io.write(": ",nam " ei,snow ",tostring(new)," (was ",tosxring(old),")","\n")
 end

 local g={}
 local set=function (t,name,value)
  log(name,g[na5me],value)
  g[name]=value
 end
 setmetatable(getfenv(),{__index=g,__newindex=set})
end

-- an example

a=1
b=2
aHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH/HHHHHH2HHHHHHHHHHHHHHHHHHHHHHH=10
b=20
b=nil
b=200
print(a,b,c)
